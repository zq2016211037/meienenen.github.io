{"ast":null,"code":"import _assertThisInitialized from \"/Users/zqian/Documents/code/2018/react/coolblog/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _classCallCheck from \"/Users/zqian/Documents/code/2018/react/coolblog/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/zqian/Documents/code/2018/react/coolblog/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/zqian/Documents/code/2018/react/coolblog/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/zqian/Documents/code/2018/react/coolblog/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/zqian/Documents/code/2018/react/coolblog/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/zqian/Documents/code/2018/react/coolblog/src/components/admin/manageblogs/bloglists/index.js\";\nimport React from 'react';\nimport { Table, Input, Popconfirm } from 'antd';\nimport axios from 'axios';\n\nvar EditableCell =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(EditableCell, _React$Component);\n\n  function EditableCell() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, EditableCell);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(EditableCell)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      value: _this.props.value,\n      editable: _this.props.editable || false\n    };\n    return _this;\n  }\n\n  _createClass(EditableCell, [{\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      if (nextProps.editable !== this.state.editable) {\n        this.setState({\n          editable: nextProps.editable\n        });\n\n        if (nextProps.editable) {\n          this.cacheValue = this.state.value;\n        }\n      }\n\n      if (nextProps.status && nextProps.status !== this.props.status) {\n        if (nextProps.status === 'save') {\n          this.props.onChange(this.state.value);\n        } else if (nextProps.status === 'cancle') {\n          this.setState({\n            value: this.cacheValue\n          });\n          this.props.onChange(this.cacheValue);\n        }\n      }\n    }\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps, nextState) {\n      return nextProps.editable !== this.state.editable || nextState.value !== this.state.value;\n    }\n  }, {\n    key: \"handleChange\",\n    value: function handleChange(e) {\n      var value = e.target.value;\n      this.setState({\n        value: value\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state = this.state,\n          value = _this$state.value,\n          editable = _this$state.editable;\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 36\n        },\n        __self: this\n      }, editable ? React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 39\n        },\n        __self: this\n      }, React.createElement(Input, {\n        value: value,\n        onChange: function onChange(e) {\n          return _this2.handleChange(e);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 40\n        },\n        __self: this\n      })) : React.createElement(\"div\", {\n        className: \"editable-row-text\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 46\n        },\n        __self: this\n      }, value.toString() || ' '));\n    }\n  }]);\n\n  return EditableCell;\n}(React.Component);\n\nvar BlogLists =\n/*#__PURE__*/\nfunction (_React$Component2) {\n  _inherits(BlogLists, _React$Component2);\n\n  function BlogLists(props) {\n    var _this3;\n\n    _classCallCheck(this, BlogLists);\n\n    _this3 = _possibleConstructorReturn(this, _getPrototypeOf(BlogLists).call(this, props));\n\n    _this3.onChange = function (page) {\n      _this3.fetchData(page);\n    };\n\n    _this3.fetchData = function (page) {\n      var reqpage = page || 1;\n      console.log(reqpage);\n\n      var that = _assertThisInitialized(_assertThisInitialized(_this3));\n\n      var url = \"http://localhost:8003/front/getBlogLists?page=\" + reqpage;\n      _this3.blogsRes = fetch(url, {\n        method: 'GET',\n        mode: 'cors',\n        headers: {\n          'Access-Control-Allow-Origin': '*'\n        }\n      }).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        console.log('获取的结果', json);\n        var result = [];\n        json.articles.forEach(function (value, index, array) {\n          var item = value;\n          var objall = {};\n          objall.key = index; // console.log(item);\n\n          Object.keys(item).forEach(function (val, i, arr) {\n            var obj = {}; // console.log(val);\n\n            obj.value = item[val];\n            obj.editable = false;\n            objall[val] = obj;\n          });\n          result.push(objall);\n        });\n        that.setState({\n          articles: result,\n          // total2: json.pages,\n          current: json.page,\n          defaultPageSize: json.limit,\n          total: json.count\n        });\n        console.log(_this3.state.articles);\n        return json;\n      }).catch(function (err) {\n        console.log('请求错误', err);\n      });\n    };\n\n    _this3.updateData = function (article_id, updateStr) {\n      var url = \"http://localhost:8003/admin/blog/saveblog\";\n      axios({\n        url: url,\n        method: 'post',\n        data: \"updateStr=\".concat(JSON.stringify(updateStr), \"&article_id=\").concat(article_id)\n      }).then(function (rs) {\n        console.log(rs);\n      }).then(function (err) {\n        console.log(err);\n      });\n    };\n\n    _this3.columns = [{\n      title: '博客标题',\n      dataIndex: 'article_title',\n      width: '15%',\n      editable: true // render: (text, record, index) => this.renderColumns(this.state.articles, index, 'article_title', text)\n\n    }, {\n      title: '博客内容',\n      dataIndex: 'article_content',\n      width: '25%',\n      // editable: true\n      render: function render(text, record, index) {\n        return _this3.renderColumns(_this3.state.articles, index, 'article_content', text);\n      }\n    }, {\n      title: '创建时间',\n      dataIndex: 'createTime',\n      width: '15%',\n      // editable: true\n      render: function render(text, record, index) {\n        return _this3.renderColumns(_this3.state.articles, index, 'createTime', text);\n      }\n    }, {\n      title: '作者',\n      dataIndex: 'author',\n      width: '15%',\n      // editable:true\n      render: function render(text, record, index) {\n        return _this3.renderColumns(_this3.state.articles, index, 'author', text);\n      }\n    }, {\n      title: 'operation',\n      dataIndex: 'operation',\n      render: function render(text, record, index) {\n        var editable = _this3.state.articles[index].article_title.editable;\n        return React.createElement(\"div\", {\n          className: \"editable-row-operations\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 88\n          },\n          __self: this\n        }, editable ? React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 91\n          },\n          __self: this\n        }, React.createElement(\"a\", {\n          onClick: function onClick() {\n            return _this3.editDone(index, 'save');\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 92\n          },\n          __self: this\n        }, \"Save\"), React.createElement(Popconfirm, {\n          title: \"Sure to cancel?\",\n          onConfirm: function onConfirm() {\n            return _this3.editDone(index, 'cancel');\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 93\n          },\n          __self: this\n        }, React.createElement(\"a\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 94\n          },\n          __self: this\n        }, \"Cancel\"))) : React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 98\n          },\n          __self: this\n        }, React.createElement(\"a\", {\n          onClick: function onClick() {\n            return _this3.edit(index);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 99\n          },\n          __self: this\n        }, \"Edit\")));\n      }\n    }];\n    _this3.state = {\n      articles: [],\n      defaultCurrent: 1,\n      current: '',\n      total: 3,\n      defaultPageSize: 2,\n      updateObj: []\n    };\n    return _this3;\n  }\n\n  _createClass(BlogLists, [{\n    key: \"renderColumns\",\n    value: function renderColumns(data, index, key, text) {\n      var _this4 = this;\n\n      var _data$index$key = data[index][key],\n          editable = _data$index$key.editable,\n          status = _data$index$key.status;\n\n      if (typeof editable === 'undefined') {\n        return text;\n      }\n\n      return React.createElement(EditableCell, {\n        editable: editable,\n        value: text,\n        onChange: function onChange(value) {\n          return _this4.handleChange(key, index, value);\n        },\n        status: status,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 120\n        },\n        __self: this\n      });\n    }\n  }, {\n    key: \"handleChange\",\n    value: function handleChange(key, index, value) {\n      var articles = this.state.articles; // var item = {};\n\n      articles[index][key].value = value; // item[key] = value;\n      // this.state.updateObj.push(item);\n\n      this.setState({\n        articles: articles\n      }); // console.log(this.state.updateObj);\n    }\n  }, {\n    key: \"edit\",\n    value: function edit(index) {\n      var articles = this.state.articles;\n      Object.keys(articles[index]).forEach(function (item) {\n        if (articles[index][item] && typeof articles[index][item].editable !== 'undefined') {\n          articles[index][item].editable = true;\n        }\n      });\n      this.setState({\n        articles: articles\n      });\n    }\n  }, {\n    key: \"editDone\",\n    value: function editDone(index, type) {\n      var articles = this.state.articles;\n      console.log(articles);\n      var updateoper = articles;\n      Object.keys(articles[index]).forEach(function (item) {\n        if (articles[index][item] && typeof articles[index][item].editable !== 'undefined') {\n          articles[index][item].editable = false;\n          articles[index][item].status = type;\n        }\n      });\n      var article_id = articles[index]._id.value;\n      var updateStr = {};\n      var newobj = JSON.parse(JSON.stringify(articles[index]));\n      console.log(newobj);\n      Object.keys(updateoper).forEach(function (val, i, arr) {\n        var updateval = updateoper[val].value;\n\n        if (val !== '_id' && val !== 'key') {\n          updateStr[val] = updateval;\n        }\n      });\n      this.updateData(article_id, updateStr);\n      this.setState({\n        articles: articles\n      }, function () {\n        Object.keys(articles[index]).forEach(function (item) {\n          if (articles[index][item] && typeof articles[index][item].editable !== 'undefined') {\n            delete articles[index][item].status;\n          }\n        });\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var articles = this.state.articles;\n      console.log(articles);\n      var dataSource = articles.map(function (item) {\n        var obj = {};\n        Object.keys(item).forEach(function (key) {\n          obj[key] = key === 'key' ? item[key] : item[key].value;\n        });\n        return obj;\n      });\n      var columns = this.columns;\n      return React.createElement(Table, {\n        bordered: true,\n        dataSource: dataSource,\n        columns: columns,\n        pagination: {\n          // 分页\n          // simple: true,\n          defaultCurrent: this.state.defaultCurrent,\n          // current: this.state.current,\n          total: this.state.total,\n          defaultPageSize: this.state.defaultPageSize,\n          onChange: this.onChange\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190\n        },\n        __self: this\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.fetchData();\n      this.render(); // console.log(this.state);\n    } // updateData = (id,updateStr) => {\n    //   var url =\"http://localhost:8888/admin/blog/saveblog\";\n    //   // var data = new FormData();\n    //   // data.append(\"_id\",\"5c25d62c90cff6082bb0cdff\");\n    //   // data.append(\"article_title\",\"it is a good day\");\n    //   var params = {\n    //     \"_id\":\"5c25d62c90cff6082bb0cdff\",\n    //     \"article_title\":\"it is a good day\"\n    //   };\n    //   this.updataBlogsRes = fetch(url,{\n    //       method: 'POST',\n    //       mode: 'cors',\n    //       body:`data=${JSON.stringify(params)}`,\n    //       // credentials: 'include',\n    //   }).then(res => {\n    //       return res.json();\n    //   }).then(json => {\n    //       console.log('获取的结果', json);\n    //       // var result = [];\n    //       // json.articles.forEach(function(value,index,array){\n    //       //   var item = value;\n    //       //   var objall = {};\n    //       //   objall.key = index;\n    //       //   Object.keys(item).forEach(function(val,i,arr){\n    //       //     var obj = {};\n    //       //       obj.value= item[val];\n    //       //       obj.editable = false;    \n    //       //       objall[val] = obj;\n    //       //   })\n    //       //   result.push(objall);\n    //       // })\n    //       // this.setState({\n    //       //     articles: result,\n    //       //     // total2: json.pages,\n    //       //     current: json.page,\n    //       //     defaultPageSize: json.limit,\n    //       //     total: json.count\n    //       // });\n    //       // return json;\n    //   }).catch(err => {\n    //       console.log('请求错误', err);});\n    // }\n\n  }]);\n\n  return BlogLists;\n}(React.Component);\n\nexport default BlogLists;","map":{"version":3,"sources":["/Users/zqian/Documents/code/2018/react/coolblog/src/components/admin/manageblogs/bloglists/index.js"],"names":["React","Table","Input","Popconfirm","axios","EditableCell","state","value","props","editable","nextProps","setState","cacheValue","status","onChange","nextState","e","target","handleChange","toString","Component","BlogLists","page","fetchData","reqpage","console","log","that","url","blogsRes","fetch","method","mode","headers","then","res","json","result","articles","forEach","index","array","item","objall","key","Object","keys","val","i","arr","obj","push","current","defaultPageSize","limit","total","count","catch","err","updateData","article_id","updateStr","data","JSON","stringify","rs","columns","title","dataIndex","width","render","text","record","renderColumns","article_title","editDone","edit","defaultCurrent","updateObj","type","updateoper","_id","newobj","parse","updateval","dataSource","map"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Table, Input, Popconfirm } from 'antd';\nimport axios from 'axios';\nclass EditableCell extends React.Component {\n  state = {\n    value: this.props.value,\n    editable: this.props.editable || false,\n  }\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.editable !== this.state.editable) {\n      this.setState({ editable: nextProps.editable });\n      if (nextProps.editable) {\n        this.cacheValue = this.state.value;\n      }\n    }\n    if (nextProps.status && nextProps.status !== this.props.status) {\n      if (nextProps.status === 'save') {\n        this.props.onChange(this.state.value);\n      } else if (nextProps.status === 'cancle') {\n        this.setState({ value: this.cacheValue });\n        this.props.onChange(this.cacheValue);\n      }\n    }\n  }\n  shouldComponentUpdate(nextProps, nextState) {\n    return nextProps.editable !== this.state.editable ||\n           nextState.value !== this.state.value;\n  }\n  handleChange(e) {\n    const value = e.target.value;\n    this.setState({ value });\n  }\n  render() {\n    const { value, editable } = this.state;\n    return (\n      <div>\n        {\n          editable ?\n            <div>\n              <Input\n                value={value}\n                onChange={e => this.handleChange(e)}\n              />\n            </div>\n            :\n            <div className=\"editable-row-text\">\n              {value.toString() || ' '}\n            </div>\n        }\n      </div>\n    );\n  }\n}\n\nclass BlogLists extends React.Component {\n  constructor(props) {\n    super(props);\n    this.columns = [{\n      title: '博客标题',\n      dataIndex: 'article_title',\n      width: '15%',\n      editable: true\n      // render: (text, record, index) => this.renderColumns(this.state.articles, index, 'article_title', text)\n    },{\n      title: '博客内容',\n      dataIndex: 'article_content',\n      width: '25%',\n      // editable: true\n      render: (text, record, index) => this.renderColumns(this.state.articles, index, 'article_content', text)\n    }, {\n      title: '创建时间',\n      dataIndex: 'createTime',\n      width: '15%',\n      // editable: true\n      render: (text, record, index) => this.renderColumns(this.state.articles, index, 'createTime', text)\n    }, {\n      title: '作者',\n      dataIndex: 'author',\n      width: '15%',\n      // editable:true\n      render: (text, record, index) => this.renderColumns(this.state.articles, index, 'author', text),\n    }, {\n      title: 'operation',\n      dataIndex: 'operation',\n      render: (text, record, index) => {\n        const { editable } = this.state.articles[index].article_title;\n        return (\n          <div className=\"editable-row-operations\">\n            {\n              editable ?\n                <span>\n                  <a onClick={() => this.editDone(index, 'save')}>Save</a>\n                  <Popconfirm title=\"Sure to cancel?\" onConfirm={() => this.editDone(index, 'cancel')}>\n                    <a>Cancel</a>\n                  </Popconfirm>\n                </span>\n                :\n                <span>\n                  <a onClick={() => this.edit(index)}>Edit</a>\n                </span>\n            }\n          </div>\n        );\n      },\n    }];\n    this.state = {\n      articles: [],\n      defaultCurrent: 1,\n      current: '',\n      total: 3,\n      defaultPageSize: 2,\n      updateObj: []\n    };\n  }\n  renderColumns(data, index, key, text) {\n    const { editable, status } = data[index][key];\n    if (typeof editable === 'undefined') {\n      return text;\n    }\n    return (<EditableCell\n      editable={editable}\n      value={text}\n      onChange={value => this.handleChange(key, index, value)}\n      status={status}\n    />);\n  }\n  handleChange(key, index, value) {\n    const { articles } = this.state;\n    // var item = {};\n    articles[index][key].value = value;\n    // item[key] = value;\n    // this.state.updateObj.push(item);\n    this.setState({\n      articles , \n    });\n    // console.log(this.state.updateObj);\n  }\n  edit(index) {\n    const { articles } = this.state;\n    Object.keys(articles[index]).forEach((item) => {\n      if (articles[index][item] && typeof articles[index][item].editable !== 'undefined') {\n        articles[index][item].editable = true;\n      }\n    });\n    this.setState({ articles });\n  }\n  editDone(index, type) {\n    const { articles } = this.state;\n    console.log(articles);\n    var updateoper = articles;\n    Object.keys(articles[index]).forEach((item) => {\n      if (articles[index][item] && typeof articles[index][item].editable !== 'undefined') {\n        articles[index][item].editable = false;\n        articles[index][item].status = type;\n      }\n    });\n    var article_id = articles[index]._id.value;\n    var updateStr = {};\n    var newobj = JSON.parse(JSON.stringify(articles[index]));\n    console.log(newobj);\n    Object.keys(updateoper).forEach(function(val,i,arr){\n      var updateval = updateoper[val].value;\n      if(val !== '_id' && val !== 'key'){\n        updateStr[val] = updateval;\n      }\n    })\n    this.updateData(article_id,updateStr);\n    this.setState({ articles }, () => {\n      Object.keys(articles[index]).forEach((item) => {\n        if (articles[index][item] && typeof articles[index][item].editable !== 'undefined') {\n          delete articles[index][item].status;\n        }\n      });\n    });\n  }\n  onChange = (page) => {\n    this.fetchData(page);\n  }\n  render() {\n    const { articles } = this.state;\n    console.log(articles);\n    const dataSource = articles.map((item) => {\n      const obj = {};\n      Object.keys(item).forEach((key) => {\n        obj[key] = key === 'key' ? item[key] : item[key].value;\n      });\n      return obj;\n    });\n    const columns = this.columns;\n    return <Table \n                    bordered \n                    dataSource={dataSource} \n                    columns={columns} \n                    pagination={{  // 分页\n                      // simple: true,\n                      defaultCurrent: this.state.defaultCurrent,\n                      // current: this.state.current,\n                      total: this.state.total,\n                      defaultPageSize: this.state.defaultPageSize,\n                      onChange: this.onChange,\n                    }}\n          />;\n  }\n  componentDidMount() {\n    this.fetchData();\n    this.render();\n    // console.log(this.state);\n  }\n  fetchData = (page) => {\n    var reqpage = page || 1;\n    console.log(reqpage);\n    var that = this;\n    var url =\"http://localhost:8003/front/getBlogLists?page=\"+reqpage;\n    this.blogsRes = fetch(url,{\n        method: 'GET',\n        mode: 'cors',\n        headers:{\n          'Access-Control-Allow-Origin':'*'\n        }\n    }).then(res => {\n        return res.json();\n    }).then(json => {\n        console.log('获取的结果', json);\n        var result = [];\n        json.articles.forEach(function(value,index,array){\n          var item = value;\n          var objall = {};\n          objall.key = index;\n          // console.log(item);\n          Object.keys(item).forEach(function(val,i,arr){\n            var obj = {};\n              // console.log(val);\n              obj.value= item[val];\n              obj.editable = false;    \n              objall[val] = obj;\n          })\n          result.push(objall);\n        })\n        that.setState({\n            articles: result,\n            // total2: json.pages,\n            current: json.page,\n            defaultPageSize: json.limit,\n            total: json.count\n        });\n        console.log(this.state.articles);\n        return json;\n    }).catch(err => {\n        console.log('请求错误', err);});\n  }\n  updateData = (article_id,updateStr) => {\n    var url =\"http://localhost:8003/admin/blog/saveblog\";\n    axios({\n      url: url,\n      method: 'post',\n      data: `updateStr=${JSON.stringify(updateStr)}&article_id=${article_id}`\n    }).then(function(rs){\n      console.log(rs)\n    }).then(function(err){\n      console.log(err);\n    })\n  }\n  // updateData = (id,updateStr) => {\n  //   var url =\"http://localhost:8888/admin/blog/saveblog\";\n  //   // var data = new FormData();\n  //   // data.append(\"_id\",\"5c25d62c90cff6082bb0cdff\");\n  //   // data.append(\"article_title\",\"it is a good day\");\n  //   var params = {\n  //     \"_id\":\"5c25d62c90cff6082bb0cdff\",\n  //     \"article_title\":\"it is a good day\"\n  //   };\n  //   this.updataBlogsRes = fetch(url,{\n  //       method: 'POST',\n  //       mode: 'cors',\n  //       body:`data=${JSON.stringify(params)}`,\n  //       // credentials: 'include',\n  //   }).then(res => {\n  //       return res.json();\n  //   }).then(json => {\n  //       console.log('获取的结果', json);\n  //       // var result = [];\n  //       // json.articles.forEach(function(value,index,array){\n  //       //   var item = value;\n  //       //   var objall = {};\n  //       //   objall.key = index;\n  //       //   Object.keys(item).forEach(function(val,i,arr){\n  //       //     var obj = {};\n  //       //       obj.value= item[val];\n  //       //       obj.editable = false;    \n  //       //       objall[val] = obj;\n  //       //   })\n  //       //   result.push(objall);\n  //       // })\n  //       // this.setState({\n  //       //     articles: result,\n  //       //     // total2: json.pages,\n  //       //     current: json.page,\n  //       //     defaultPageSize: json.limit,\n  //       //     total: json.count\n  //       // });\n  //       // return json;\n  //   }).catch(err => {\n  //       console.log('请求错误', err);});\n  // }\n}\n\nexport default BlogLists;"]},"metadata":{},"sourceType":"module"}